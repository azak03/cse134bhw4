<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="description" content="Anthony Z.'s contact!">
    <meta name="keywords" content="Anthony Z., Contact">
    <meta name="author" content="Anthony Z.">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Contact me</title>
    <link rel="stylesheet" href="resources/globalstyle.css">
    <link rel="stylesheet" href="resources/contactstyle.css">
</head>
<body>
    <nav class="links">
        <button id="mobile" type="button">â˜°</button>
        <a href="index.html">Home</a>
        <a href="projects.html">Projects</a>
        <a href="contact.html">Contact</a>
    </nav>

    <hgroup>
        <h1><span class="container">Contact</span></h1>
    </hgroup>
    <section>
        <h2>Contact Form</h2>
        <form action="https://httpbin.org/get" method="GET" id="contactform">
            <fieldset>
                <label for="name">Name:<em>*</em></label>
                <input type="text" id="name" name="name" required minlength="4" maxlength="60" pattern="^[A-Za-z]+$">
                <label for="reason">Email:<em>*</em></label>
                <input type="text" id="email" name="email" required minlength="5" maxlength="60" pattern="^(?!.*\..*\.)(?!.*@.*@).*">
                <label for="message">Comments:<em>*</em></label>
                <div id="counter">500 characters remaining</div>
                <textarea id="comments" name="comments" required minlength="5" maxlength="500"></textarea>
                <input type="hidden" id="possible_bot" name="possible_bot" value="true">
                <input type="hidden" id="form-errors" name="form-errors">
                <button type="submit">Submit</button>
                <br>
                <br>
                <output class="error-message">OUTPUT: An error occurred.</output>
                <br>
                <output class="info-message">OUTPUT: Your form was sent.</output>
            </fieldset>
            <br>
      </form>
    </section>
    <script>
    let form = document.getElementById("contactform");
    let comments = document.getElementById("comments");
    let counter = document.getElementById("counter");
    let formerrors = {};
    formerrors['name'] = [];
    formerrors['email'] = [];
    formerrors['comments'] = [];
    let erroroutput = document.getElementsByClassName("error-message")[0];
    
    document.querySelectorAll("input[pattern]").forEach(field => {
    let pattern = new RegExp(field.pattern);
    field.addEventListener("input", (e) => {
        if (!pattern.test(e.target.value) && e.target.value.length > 0) {
            formerrors[field.name].push("Invalid character!");
            e.target.classList.add("flash");
            erroroutput.textContent = `Rejected character in ${field.name} field!`;
            erroroutput.classList.add("fade");
            setTimeout(() => {
                e.target.classList.remove("flash");
                erroroutput.classList.remove("fade");
            }, 1000);
            e.target.value = e.target.value.slice(0, -1);
        }
        });
    });
    comments.addEventListener("input", () => {
        let remaining = 500 - comments.value.length;
        counter.textContent = `${remaining} characters remaining`;
        if (remaining <= 50) {
            if (remaining <= 0) {
                if(remaining < 0) {
                    formerrors["comments"].push("Length exceeded");
                }
                if (counter.classList.contains("warn")) {
                    counter.classList.remove("warn");
                }
                counter.classList.add("error");
            } else {
                if (counter.classList.contains("error")) {
                    counter.classList.remove("error");
                }
                counter.classList.add("warn");
            }
        } else {
            if (counter.classList.contains("warn")) {
                counter.classList.remove("warn");
            }
            if (counter.classList.contains("error")) {
                counter.classList.remove("error");
            }
        }
    });
    form.addEventListener("submit", (e) => {
        e.preventDefault();
        document.getElementById("form-errors").value = JSON.stringify(formerrors);
    });
    </script>
    <noscript>Warning: Your browser does not have JavaScript support or JavaScript is disabled! This may cause problems when viewing my site!</noscript>
</body>
</html>
